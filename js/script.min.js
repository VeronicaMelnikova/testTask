"use strict";var nameValue,countValue,priceValue,MAX_LENGTH=15,catalog=document.querySelector(".catalog"),addField=document.querySelector(".add-update"),addForm=document.querySelector(".add-update__form"),openAddField=document.querySelector(".button--add-new"),buttonAddProduct=addForm.querySelector(".button--add"),search=document.querySelector(".button--search"),nameField=addForm.querySelector(".add-update__name-field"),countField=addForm.querySelector(".add-update__count-field"),priceField=addForm.querySelector(".add-update__price-field"),errorMessage=addField.querySelector(".error-message"),arrorAscendingPrice=catalog.querySelector(".catalog__arrow-increase-price"),arrorDescendingPrice=catalog.querySelector(".catalog__arrow-decrease-price"),startPrice=0,productsData=[{name:"Монитор",count:5,price:"$12,352.25"},{name:"Клавиатура",count:5,price:"$12,351.25"},{name:"Мышка",count:5,price:"$12,350.25"}],makeElement=function(e,t,r){var a=document.createElement(e);return a.classList.add(t),r&&(a.textContent=r),a},createProduct=function(e,t){var r=makeElement("ul","catalog__product"),a=makeElement("li","product__item"),d=makeElement("div","product__description"),o=makeElement("a","product__name",e.name),c=makeElement("p","product__count",e.count),n=makeElement("li","product__price"),u=makeElement("p","product__price-value",e.price),i=makeElement("li","product__actions"),l=makeElement("div","product__actions-wrapper"),s=makeElement("button","button-edit","Edit"),p=makeElement("button","button-delete","Delete");return o.href="#",d.appendChild(o),d.appendChild(c),a.appendChild(d),n.appendChild(u),l.appendChild(s),l.appendChild(p),i.appendChild(l),r.appendChild(a),r.appendChild(n),r.appendChild(i),r},renderProducts=function(e){for(var t=e;t<productsData.length;t++){var r=createProduct(productsData[t],t);catalog.appendChild(r)}};renderProducts(0);var comparePrice=function(e,t){var r=e.price,a=t.price,d=r.indexOf(","),o=a.indexOf(",");return(r=parseFloat(r.substring(1,d)+r.substring(d+1)))-(a=parseFloat(a.substring(1,o)+a.substring(o+1)))},sortbyAscendingPrice=function(){productsData.sort(comparePrice)};arrorAscendingPrice.addEventListener("click",function(e){e.preventDefault(),sortbyAscendingPrice(),deleteProducts(0,productsData.length),renderProducts(0),arrorAscendingPrice.classList.add("hidden"),arrorDescendingPrice.classList.remove("hidden")}),openAddField.addEventListener("click",function(e){addField.classList.add("add-update--show"),addForm.reset(),buttonAddProduct.value="Add"});var closeAddField=function(){addField.classList.remove("add-update--show")},hideUnsuitableProductbyName=function(e){var t=catalog.querySelectorAll(".catalog__product"),r=[];if(""!==e){for(var a=0;a<productsData.length;a++){t[a].classList.remove("product--hidden"),productsData[a].name.toUpperCase()!==e.toUpperCase()&&r.push(a)}for(a=0;a<r.length;a++){t[r[a]].classList.add("product--hidden")}}};search.addEventListener("click",function(e){e.preventDefault();var t=document.querySelector(".search__field").value;hideUnsuitableProductbyName(t)});var addNewProduct=function(e,t,r){var a=productsData.length;productsData[a]={},productsData[a].name=e,productsData[a].count=t,productsData[a].price=r},checkName=function(e){var t=" ";if(!(e&&e.length<=MAX_LENGTH))return!1;for(var r=1;r<MAX_LENGTH;r++){if(e!==t)return e;t+=" "}},convertPrice=function(e){var t=0;if(1<=e/1e3){var r=Math.floor(e/1e3),a=e%1e3;a=a.toFixed(2),t="$"+r.toString()+","+a.toString()}else t="$"+e.toString();return t};priceField.addEventListener("blur",function(){startPrice=priceField.value,priceField.type="text",priceField.value=convertPrice(priceField.value)}),priceField.addEventListener("focus",function(){priceField.type="number",priceField.value=startPrice});var showError=function(){nameField.classList.add("error"),errorMessage.classList.add("error-message--show")},getFieldValue=function(){nameValue=nameField.value,countValue=countField.value,priceValue=priceField.value},writeProductParameters=function(){return getFieldValue(),addNewProduct(nameValue,countValue,priceValue),checkName(nameValue)},rewriteProduct=function(e){return getFieldValue(),productsData[e].name=nameValue,productsData[e].count=countValue,productsData[e].price=priceValue,checkName(nameValue)};addForm.addEventListener("submit",function(e){e.preventDefault(),"Add"===buttonAddProduct.value&&(writeProductParameters()?(renderProducts(productsData.length-1),closeAddField(),addForm.reset()):showError()),"Update"===buttonAddProduct.value&&(rewriteProduct(productNumber)?(rewriteProduct(productNumber),deleteProducts(0,productsData.length),renderProducts(0),closeAddField(),addForm.reset()):showError())});var deleteProducts=function(e,t){for(var r=catalog.querySelectorAll(".catalog__product"),a=e;a<t;a++)catalog.removeChild(r[a])};nameField.addEventListener("mouseup",function(){nameField.classList.remove("error"),errorMessage.classList.remove("error-message--show")},!0);var productNumber,initialProduct,getProductValue=function(e){var t=e.querySelector(".product__name").textContent;return nameField.value=t,countField.value=e.querySelector(".product__count").textContent,priceField.type="text",priceField.value=e.querySelector(".product__price-value").textContent,t},searchProductByName=function(e){catalog.querySelectorAll(".catalog__product");for(var t=0;t<productsData.length;t++){if(productsData[t].name===e)return t}},confirmationPopup=document.querySelector(".confirmation"),buttonCancel=confirmationPopup.querySelector(".button__cancel"),buttonConsent=confirmationPopup.querySelector(".button__consent"),closeConfirmationPopup=function(){confirmationPopup.classList.remove("confirmation--show")};catalog.addEventListener("click",function(e){for(var t=e.target;t!==this;)"button-edit"===t.className&&(addField.classList.add("add-update--show"),buttonAddProduct.value="Update"),"button-delete"===t.className&&(confirmationPopup.classList.add("confirmation--show"),buttonCancel.addEventListener("click",function(){closeConfirmationPopup()}),buttonConsent.addEventListener("click",function(){deleteProducts(0,productsData.length),productsData.splice(productNumber,1),renderProducts(0),closeConfirmationPopup()})),"catalog__product"===(t=t.parentNode).className&&(getProductValue(initialProduct=t),productNumber=searchProductByName(getProductValue(t)),rewriteProduct(productNumber))});